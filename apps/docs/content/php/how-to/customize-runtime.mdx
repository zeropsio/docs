---
title: Customize PHP runtime environment
description: Learn how you can customize your php runtime environment in Zerops.
---

import data from '@site/static/data.json';
import { SetVar } from '@site/src/components/content/var';
import CustomizeRuntimeContent from '@site/src/components/content/customize-runtime.mdx';

<SetVar name="serviceDisplay" value="PHP" />
<SetVar name="serviceVersion" value={data.php.base.runtime.apache[0][0]} />
<SetVar name="servicePath" value="php" />
<SetVar name="defaultEnvironment" value="Git and Composer" />
<SetVar name="packageManager" value="Composer" />
<SetVar name="codeLanguage" value="yaml" />
<SetVar name="customReasons" value={[
  '<strong>System packages for processing</strong>: When your app processes images, videos, or files (requiring packages like <code>sudo apk add --no-cache imagemagick</code>)',
  '<strong>PHP extensions</strong>: When you need additional PHP extensions not included by default',
  '<strong>Native dependencies</strong>: When your Composer packages require system libraries that aren\'t in the default environment',
  '<strong>Different base OS</strong>: When you need Ubuntu instead of Alpine for specific compatibility requirements'
]} />
<SetVar name="basicSetupCode" value={`run:
  os: ubuntu
  base: {{serviceVersion}}
  prepareCommands:
    - sudo apt-get install -y imagemagick
    - composer global require some/package`} />
<SetVar name="buildFilesCode" value={`build:
  addToRunPrepare:
    - composer.json
    - composer.lock
run:
  prepareCommands:
    - sudo apk add --no-cache imagemagick
    - sudo apk add --no-cache ffmpeg
    - composer install --no-dev`} />

<CustomizeRuntimeContent />

## Overwrite php.ini files

You can override PHP configuration directives by setting environment variables in your `zerops.yaml` file.

Here's an example of how to adjust PHP's `post_max_size` directive:
```yaml
zerops:
  # define hostname of your service
  - setup: app
    # ==== how to run your application ====
    run:
      # REQUIRED. Sets the base technology for the runtime environment:
      base: php-nginx@8.3

      # OPTIONAL. Defines the env variables for the runtime:
      envVariables:
        PHP_INI_post_max_size: 10M
```

:::info
After updating PHP-FPM configuration in your `zerops.yaml` file, you need to restart or reload the app for the changes to take effect.
:::

## PHP-FPM

### Default PHP-FPM configuration

PHP-FPM (FastCGI Process Manager) uses the **dynamic** process management mode by default. In this mode, the system automatically adjusts the number of PHP processes based on current load.

The default PHP-FPM configuration uses these values:

- `PHP_FPM_PM` = `dynamic`
- `PHP_FPM_PM_MAX_CHILDREN` = `20`
- `PHP_FPM_PM_START_SERVERS` = `2`
- `PHP_FPM_PM_MIN_SPARE_SERVERS` = `1`
- `PHP_FPM_PM_MAX_SPARE_SERVERS` = `3`
- `PHP_FPM_PM_MAX_SPAWN_RATE` = `32`
- `PHP_FPM_PM_MAX_REQUESTS` = `500`

### Dynamic mode

To adjust the dynamic mode settings, add the desired environment variables to the run section:
```yaml
zerops:
  # define hostname of your service
  - setup: app
    # ==== how to run your application ====
    run:
      # OPTIONAL. Defines the env variables for the runtime:
      envVariables:
        PHP_FPM_PM_MAX_CHILDREN: 30
        PHP_FPM_PM_START_SERVERS: 5
        PHP_FPM_PM_MIN_SPARE_SERVERS: 2
        PHP_FPM_PM_MAX_SPARE_SERVERS: 10
        PHP_FPM_PM_MAX_REQUESTS: 1000
```

### Ondemand mode

The **ondemand** mode is ideal for applications with lower traffic, where processes are created only when requests arrive. To enable ondemand mode:
```yaml
zerops:
  # define hostname of your service
  - setup: app
    # ==== how to run your application ====
    run:
      # OPTIONAL. Defines the env variables for the runtime:
      envVariables:
        PHP_FPM_PM: ondemand
        PHP_FPM_PM_MAX_CHILDREN: 20
        PHP_FPM_PM_PROCESS_IDLE_TIMEOUT: 60s
        PHP_FPM_PM_MAX_REQUESTS: 500
```

**Available parameters for ondemand mode:**

- `PHP_FPM_PM_MAX_CHILDREN` – maximum number of child processes
- `PHP_FPM_PM_PROCESS_IDLE_TIMEOUT` – time after which idle processes are terminated (default: `60s`)
- `PHP_FPM_PM_MAX_REQUESTS` – number of requests each process handles before being recycled (default: `500`)

:::info
After updating PHP-FPM configuration in your `zerops.yaml` file, you need to restart or reload the app for the changes to take effect.
:::